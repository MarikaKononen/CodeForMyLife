jQuery(function(t){"use strict";var e,n,a=function(e){var n=t(e);n.find(".select2-select.connector_or_context").each(function(e,n){t(n).select2({allowClear:!0,placeholder:streamAlerts.anyContext,templateResult:function(e){return void 0===e.id?e.text:t(-1===e.id.indexOf("-")?'<span class="parent">'+e.text+"</span>":'<span class="child">'+e.text+"</span>")},matcher:function(e,n){var a=t.extend(!0,{},n);if(null===e.term||""===t.trim(e.term))return a;var i=e.term.toLowerCase();if(a.id=a.id.replace("blogs","sites"),a.id.toLowerCase().indexOf(i)>=0)return a;if(a.children){for(var r=a.children.length-1;r>=0;r--)-1===a.children[r].id.toLowerCase().indexOf(i)&&a.children.splice(r,1);if(a.children.length>0)return a}return null}}).change(function(){var e=t(this).val();if(e){var n=e.split("-");t(this).siblings(".connector").val(n[0]),t(this).siblings(".context").val(n[1])}});var a=[t(n).siblings(".connector").val(),t(n).siblings(".context").val()];""===a[1]&&a.splice(1,1),t(n).val(a.join("-")).trigger("change")}),n.find("select.select2-select:not(.connector_or_context)").each(function(){var e=t(this).attr("id").split("_"),n=e[e.length-1].charAt(0).toUpperCase()+e[e.length-1].slice(1);t(this).select2({allowClear:!0,placeholder:streamAlerts.any+" "+n})})},i=t("#wp_stream_alert_type"),r=function(e){var n={action:"load_alerts_settings",alert_type:e},a=t("#wp_stream_alert_type").closest("tr").attr("id");n.post_id=a.split("-")[1],t.post(window.ajaxurl,n,function(e){var n=t("#wp_stream_alert_type_form");"none"!==t("#wp_stream_alert_type").val()?(n.html(e.data.html),n.show()):n.hide()})};t("#the-list").on("change","#wp_stream_trigger_connector_or_context",function(){if("wp_stream_trigger_connector_or_context"===t(this).attr("id")){var e=t(this).val();e&&0<e.indexOf("-")&&(e=e.split("-")[0]),s(e)}});var s=function(e){var n=t("#wp_stream_trigger_action");n.empty(),n.prop("disabled",!0);var a=t("<option/>",{value:"",text:""});n.append(a);var i={action:"get_actions",connector:e};t.post(window.ajaxurl,i,function(e){var a=e.success,i=e.data;if(a){for(var r in i)if(i.hasOwnProperty(r)){var s=i[r],l=t("<option/>",{value:r,text:s});n.append(l)}n.prop("disabled",!1),t(document).trigger("alert-actions-updated")}})};i.change(function(){r(t(this).val())}),t("#wpbody-content").on("click","a.page-title-action",function(e){e.preventDefault(),t("#add-new-alert").remove(),t(".inline-edit-wp_stream_alerts").length>0&&t(".inline-edit-wp_stream_alerts .inline-edit-save button.button-secondary.cancel").trigger("click");var n="",i={action:"get_new_alert_triggers_notifications"};t.post(window.ajaxurl,i,function(e){if(!0===e.success){n=e.data.html,t("tbody#the-list").prepend('<tr id="add-new-alert" class="inline-edit-row inline-edit-row-page inline-edit-page quick-edit-row quick-edit-row-page inline-edit-page inline-editor" style=""><td colspan="4" class="colspanchange">'+n+'<p class="submit inline-edit-save"> <button type="button" class="button-secondary cancel alignleft">Cancel</button> <input type="hidden" id="_inline_edit" name="_inline_edit" value="3550d271fe"> <button type="button" class="button-primary save alignright">Save</button> <span class="spinner"></span><span class="error" style="display:none"></span> <br class="clear"></p></td></tr>');var i=t("#add-new-alert"),s=i.css("background-color");i.css("background-color","#C1E1B9"),setTimeout(function(){i.css("background-color",s)},250),t("#wp_stream_alert_type").change(function(){r(t(this).val())}),i.on("click",".button-secondary.cancel",function(){t("#add-new-alert").remove()}),i.on("click",".button-primary.save",l),a("#add-new-alert")}})});var l=function(e){e.preventDefault(),t("#add-new-alert").find("p.submit.inline-edit-save span.spinner").css("visibility","visible");var n={action:"save_new_alert",wp_stream_alerts_nonce:t("#wp_stream_alerts_nonce").val(),wp_stream_trigger_author:t("#wp_stream_trigger_author").val(),wp_stream_trigger_context:t("#wp_stream_trigger_connector_or_context").val(),wp_stream_trigger_action:t("#wp_stream_trigger_action").val(),wp_stream_alert_type:t("#wp_stream_alert_type").val(),wp_stream_alert_status:t("#wp_stream_alert_status").val()};t("#wp_stream_alert_type_form").find(":input").each(function(){var e=t(this).attr("id");t(this).val()&&(n[e]=t(this).val())}),t.post(window.ajaxurl,n,function(e){!0===e.success&&(t("#add-new-alert").find("p.submit.inline-edit-save span.spinner").css("visibility","hidden"),location.reload())})},o=inlineEditPost.edit;if(inlineEditPost.edit=function(i){o.apply(this,arguments);var r=0;if("object"==typeof i&&(r=parseInt(this.getId(i),10)),r>0){n=t("#edit-"+r);var s=(e=t("#post-"+r)).find('input[name="wp_stream_trigger_connector"]').val(),l=e.find('input[name="wp_stream_trigger_context"]').val(),c=s+"-"+l,p=e.find('input[name="wp_stream_trigger_action"]').val(),_=e.find('input[name="wp_stream_alert_status"]').val();n.find('input[name="wp_stream_trigger_connector"]').attr("value",s),n.find('input[name="wp_stream_trigger_context"]').attr("value",l),n.find('select[name="wp_stream_trigger_connector_or_context"] option[value="'+c+'"]').attr("selected","selected"),t(document).one("alert-actions-updated",function(){n.find('input[name="wp_stream_trigger_action"]').attr("value",p),n.find('select[name="wp_stream_trigger_action"] option[value="'+p+'"]').attr("selected","selected").trigger("change")}),n.find('select[name="wp_stream_alert_status"] option[value="'+_+'"]').attr("selected","selected"),a("#edit-"+r),t("#wp_stream_alert_type_form").hide();var d=e.find('input[name="wp_stream_alert_type"]').val();n.find('select[name="wp_stream_alert_type"] option[value="'+d+'"]').attr("selected","selected").trigger("change")}},window.location.hash){var c=t(window.location.hash);if(c.length){var p=c.offset().top-t("#wpadminbar").height();t("html, body").animate({scrollTop:p},1e3),c.find(".row-actions a.editinline").trigger("click")}}});